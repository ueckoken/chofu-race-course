syntax = "proto3";
package spec.v1;
option go_package = "github.com/ueckoken/chofu-race-course/go/_proto/spec/v1";
import "google/protobuf/timestamp.proto";
service UserDataService {
  rpc UserData(UserDataRequest) returns (UserDataResponse) {}
}

message User {
  string id = 1;
}
message UserDataRequest {
  string user_id = 1;
}
message UserDataResponse {
  User user = 1;
}

service HorseDataService {
  rpc HorseData(HorseDataRequest) returns (HorseDataResponse) {}
  rpc AllHorseData(AllHorseDataRequest) returns (AllHorseDataResponse) {}
}

message Horse {
  uint64 id = 1;
  string name = 2;
}

message History {
  Race race = 1;
  uint64 order = 2;
  uint64 result = 3;
}

message HorseDetail {
  string name = 1;
  string owner = 2;
  uint64 wins = 3;
  uint64 matches = 4;
  optional uint64 next = 5;
  repeated History history = 6;
}

message HorseDataRequest {
  uint64 id = 1;
}
message HorseDataResponse {
  HorseDetail horse = 1;
}
message AllHorseDataRequest {}
message AllHorseDataResponse {
  repeated Horse horses = 1;
}

service RaceDataService {
  rpc RangeRaceData(RangeRaceDataRequest) returns (RangeRaceDataResponse){}
  rpc RaceData(RaceDataRequest) returns (RaceDataResponse){}
}
message Race {
  uint64 id = 1;
  string name = 2;
  uint64 order = 3;
  google.protobuf.Timestamp start = 4;
}
message Member {
  uint64 order = 1;
  uint64 result = 2;
  Horse horse = 3;
  double odds = 4;
  uint64 popularity = 5;
}
message Result {
  Horse horse = 1;
  uint64 order = 2;
  uint64 return = 3;
}
message RaceDetail {
  uint64 id = 1;
  string description = 2;
  uint64 order = 3;
  bool isFinished = 4;
  repeated Member member = 5;
  Result result = 6;
  google.protobuf.Timestamp start = 7;
  google.protobuf.Timestamp voteBegin = 8;
  google.protobuf.Timestamp voteEnd = 9;
}
message RangeRaceDataRequest {
  // 指定した時間を含む、指定した時間からのデータを取得する。指定しなかったときは0(=1970年1月1日)と見なす。
  optional google.protobuf.Timestamp begin = 1;
  // 指定した時間を含む、指定した時間までのデータを取得する。指定しなかったときは取得できる最新まで取得する。
  optional google.protobuf.Timestamp end = 2;
}
message RangeRaceDataResponse {
  repeated Race races = 1;
}
message RaceDataRequest{
  uint64 race_id = 1;
}
message RaceDataResponse{
  RaceDetail race = 1;
}
